import{s as ce,f as E,l as J,g as S,h as V,m as Q,d as g,j as I,i as H,u as v,n as fe,K as B,a as R,c as N,T as ue,U as j,I as de,o as be,p as G,e as K,R as me}from"../chunks/scheduler.2996579b.js";import{S as he,i as pe,b as U,d as q,m as z,t as C,c as F,a as y,e as W,g as Y}from"../chunks/index.00b56f8c.js";import{e as A}from"../chunks/each.4e61ef43.js";import{K as _e}from"../chunks/KPost.8bf6e13e.js";import{K as ke,d as ee}from"../chunks/KTextArea.b9d9b606.js";import{u as ve}from"../chunks/stores.88811b96.js";import{g as we}from"../chunks/navigation.89f88307.js";import{f as ye}from"../chunks/alerts.73a0c392.js";import{b as ge}from"../chunks/paths.68928830.js";import{g as te,a as se,l as Te,b as oe}from"../chunks/convo.b82e986b.js";function Ee(r){let t,e,o,s=r[0].text+" - "+r[0].humanTime(),i;return{c(){t=E("div"),e=E("div"),o=E("p"),i=J(s),this.h()},l(n){t=S(n,"DIV",{class:!0});var l=V(t);e=S(l,"DIV",{class:!0});var a=V(e);o=S(a,"P",{});var p=V(o);i=Q(p,s),p.forEach(g),a.forEach(g),l.forEach(g),this.h()},h(){I(e,"class","border-0 space-y-2 w-full mt-4 variant-filled-surface p-2 w-9/12 mx-auto rounded-xl"),I(t,"class","grid gap-4 text-center mx-auto")},m(n,l){H(n,t,l),v(t,e),v(e,o),v(o,i)},p(n,[l]){l&1&&s!==(s=n[0].text+" - "+n[0].humanTime())&&fe(i,s)},i:B,o:B,d(n){n&&g(t)}}}function Se(r,t,e){let{msg:o}=t;return r.$$set=s=>{"msg"in s&&e(0,o=s.msg)},[o]}class Ie extends he{constructor(t){super(),pe(this,t,Se,Ee,ce,{msg:0})}}function ne(r,t,e){const o=r.slice();return o[22]=t[e],o[24]=e,o}function le(r,t,e){const o=r.slice();return o[10]=t[e],o[26]=e,o}function Ce(r){let t,e,o=A(r[3]),s=[];for(let n=0;n<o.length;n+=1)s[n]=ae(ne(r,o,n));const i=n=>C(s[n],1,1,()=>{s[n]=null});return{c(){for(let n=0;n<s.length;n+=1)s[n].c();t=K()},l(n){for(let l=0;l<s.length;l+=1)s[l].l(n);t=K()},m(n,l){for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(n,l);H(n,t,l),e=!0},p(n,l){if(l&394){o=A(n[3]);let a;for(a=0;a<o.length;a+=1){const p=ne(n,o,a);s[a]?(s[a].p(p,l),y(s[a],1)):(s[a]=ae(p),s[a].c(),y(s[a],1),s[a].m(t.parentNode,t))}for(Y(),a=o.length;a<s.length;a+=1)i(a);F()}},i(n){if(!e){for(let l=0;l<o.length;l+=1)y(s[l]);e=!0}},o(n){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)C(s[l]);e=!1},d(n){n&&g(t),me(s,n)}}}function He(r){let t,e="Please Wait...";return{c(){t=E("p"),t.textContent=e,this.h()},l(o){t=S(o,"P",{class:!0,["data-svelte-h"]:!0}),ue(t)!=="svelte-19o54u0"&&(t.textContent=e),this.h()},h(){I(t,"class","p")},m(o,s){H(o,t,s)},p:B,i:B,o:B,d(o){o&&g(t)}}}function $e(r){let t,e,o,s,i,n=A(r[22].replies),l=[];for(let f=0;f<n.length;f+=1)l[f]=re(le(r,n,f));const a=f=>C(l[f],1,1,()=>{l[f]=null});function p(){return r[14](r[24])}function d(){return r[15](r[24])}return e=new _e({props:{src:r[1][r[22].author].photo,msg:r[22],reply:p,like:d}}),{c(){for(let f=0;f<l.length;f+=1)l[f].c();t=R(),U(e.$$.fragment),o=R(),s=E("hr"),this.h()},l(f){for(let u=0;u<l.length;u+=1)l[u].l(f);t=N(f),q(e.$$.fragment,f),o=N(f),s=S(f,"HR",{class:!0}),this.h()},h(){I(s,"class","border-4 rounded-full drop-shadow-xl")},m(f,u){for(let _=0;_<l.length;_+=1)l[_]&&l[_].m(f,u);H(f,t,u),z(e,f,u),H(f,o,u),H(f,s,u),i=!0},p(f,u){if(r=f,u&138){n=A(r[22].replies);let m;for(m=0;m<n.length;m+=1){const $=le(r,n,m);l[m]?(l[m].p($,u),y(l[m],1)):(l[m]=re($),l[m].c(),y(l[m],1),l[m].m(t.parentNode,t))}for(Y(),m=n.length;m<l.length;m+=1)a(m);F()}const _={};u&10&&(_.src=r[1][r[22].author].photo),u&8&&(_.msg=r[22]),e.$set(_)},i(f){if(!i){for(let u=0;u<n.length;u+=1)y(l[u]);y(e.$$.fragment,f),i=!0}},o(f){l=l.filter(Boolean);for(let u=0;u<l.length;u+=1)C(l[u]);C(e.$$.fragment,f),i=!1},d(f){f&&(g(t),g(o),g(s)),me(l,f),W(e,f)}}}function De(r){let t,e,o,s;return t=new Ie({props:{msg:r[22]}}),{c(){U(t.$$.fragment),e=R(),o=E("hr"),this.h()},l(i){q(t.$$.fragment,i),e=N(i),o=S(i,"HR",{class:!0}),this.h()},h(){I(o,"class","border-4 rounded-full drop-shadow-xl")},m(i,n){z(t,i,n),H(i,e,n),H(i,o,n),s=!0},p(i,n){const l={};n&8&&(l.msg=i[22]),t.$set(l)},i(i){s||(y(t.$$.fragment,i),s=!0)},o(i){C(t.$$.fragment,i),s=!1},d(i){i&&(g(e),g(o)),W(t,i)}}}function Ve(r){let t,e,o,s;function i(){return r[13](r[10])}return e=new _e({props:{src:r[1][r[3][r[10]].author].photo,msg:r[3][r[10]],isReply:!0,like:i}}),{c(){t=E("div"),U(e.$$.fragment),o=R(),this.h()},l(n){t=S(n,"DIV",{class:!0});var l=V(t);q(e.$$.fragment,l),o=N(l),l.forEach(g),this.h()},h(){I(t,"class","w-9/12 mx-auto align-center")},m(n,l){H(n,t,l),z(e,t,null),v(t,o),s=!0},p(n,l){r=n;const a={};l&10&&(a.src=r[1][r[3][r[10]].author].photo),l&8&&(a.msg=r[3][r[10]]),l&8&&(a.like=i),e.$set(a)},i(n){s||(y(e.$$.fragment,n),s=!0)},o(n){C(e.$$.fragment,n),s=!1},d(n){n&&g(t),W(e)}}}function re(r){let t,e,o=r[26]<3&&Ve(r);return{c(){o&&o.c(),t=K()},l(s){o&&o.l(s),t=K()},m(s,i){o&&o.m(s,i),H(s,t,i),e=!0},p(s,i){s[26]<3&&o.p(s,i)},i(s){e||(y(o),e=!0)},o(s){C(o),e=!1},d(s){s&&g(t),o&&o.d(s)}}}function ae(r){let t,e,o,s;const i=[De,$e],n=[];function l(a,p){return a[22].author==="SYSTEM"?0:a[22].replyTo?-1:1}return~(t=l(r))&&(e=n[t]=i[t](r)),{c(){e&&e.c(),o=K()},l(a){e&&e.l(a),o=K()},m(a,p){~t&&n[t].m(a,p),H(a,o,p),s=!0},p(a,p){let d=t;t=l(a),t===d?~t&&n[t].p(a,p):(e&&(Y(),C(n[d],1,1,()=>{n[d]=null}),F()),~t?(e=n[t],e?e.p(a,p):(e=n[t]=i[t](a),e.c()),y(e,1),e.m(o.parentNode,o)):e=null)},i(a){s||(y(e),s=!0)},o(a){C(e),s=!1},d(a){a&&g(o),~t&&n[t].d(a)}}}function Me(r){let t,e,o,s,i,n,l=r[2]?"Classroom "+r[2]:"Loading...",a,p,d,f="settings",u,_,m,$,k,T,w,M;m=new ke({props:{onclick:r[9],sendOnEnter:!1}});const L=[He,Ce],D=[];function O(h,b){return!h[6].name||!h[1]||!h[3].length?0:1}return T=O(r),w=D[T]=L[T](r),{c(){t=E("div"),e=E("div"),o=E("a"),s=J("arrow_back_ios"),i=R(),n=E("h3"),a=J(l),p=R(),d=E("button"),d.textContent=f,u=R(),_=E("div"),U(m.$$.fragment),$=R(),k=E("section"),w.c(),this.h()},l(h){t=S(h,"DIV",{class:!0});var b=V(t);e=S(b,"DIV",{class:!0});var c=V(e);o=S(c,"A",{class:!0,href:!0});var P=V(o);s=Q(P,"arrow_back_ios"),P.forEach(g),i=N(c),n=S(c,"H3",{class:!0});var X=V(n);a=Q(X,l),X.forEach(g),p=N(c),d=S(c,"BUTTON",{class:!0,["data-svelte-h"]:!0}),ue(d)!=="svelte-1o7k9cj"&&(d.textContent=f),c.forEach(g),u=N(b),_=S(b,"DIV",{});var Z=V(_);q(m.$$.fragment,Z),Z.forEach(g),$=N(b),k=S(b,"SECTION",{class:!0});var x=V(k);w.l(x),x.forEach(g),b.forEach(g),this.h()},h(){I(o,"class","btn-icon material-symbols-outlined w-8 h-8"),I(o,"href",ge+"/classrooms"),I(n,"class","h3 px-2 my-auto"),I(d,"class","material-symbols-outlined ml-auto mr-3 w-8 h-8 my-auto"),I(e,"class","h-auto flex flex-row variant-filled-primary mt-4 p-1"),I(k,"class","flex flex-col-reverse p-4 overflow-y-auto space-y-4 mb-8"),j(k,"placeholder",!r[3].length),j(k,"animate-pulse",!r[3].length),I(t,"class","flex flex-col max-h-screen overflow-hidden px-4 lg:pl-0")},m(h,b){H(h,t,b),v(t,e),v(e,o),v(o,s),v(e,i),v(e,n),v(n,a),v(e,p),v(e,d),r[11](e),v(t,u),v(t,_),z(m,_,null),r[12](_),v(t,$),v(t,k),D[T].m(k,null),r[16](k),M=!0},p(h,[b]){(!M||b&4)&&l!==(l=h[2]?"Classroom "+h[2]:"Loading...")&&fe(a,l);let c=T;T=O(h),T===c?D[T].p(h,b):(Y(),C(D[c],1,1,()=>{D[c]=null}),F(),w=D[T],w?w.p(h,b):(w=D[T]=L[T](h),w.c()),y(w,1),w.m(k,null)),(!M||b&8)&&j(k,"placeholder",!h[3].length),(!M||b&8)&&j(k,"animate-pulse",!h[3].length)},i(h){M||(y(m.$$.fragment,h),y(w),M=!0)},o(h){C(m.$$.fragment,h),C(w),M=!1},d(h){h&&g(t),r[11](null),W(m),r[12](null),D[T].d(),r[16](null)}}}function ie(r){const t=r.offsetHeight,e=getComputedStyle(r),o=parseInt(e.getPropertyValue("margin-top")),s=parseInt(e.getPropertyValue("margin-bottom"));return t+o+s}function Pe(r,t,e){let o;de(r,ve,c=>e(6,o=c));let s;var i={};let n;var l=[],a,p;function d(){return window.innerHeight-ie(a)-ie(p)-32}window.addEventListener("resize",()=>{try{e(0,s.style.maxHeight=d().toString()+"px",s),e(0,s.style.minHeight=d().toString()+"px",s)}catch{}});function f(){s.scrollTo({top:-s.scrollHeight,behavior:"smooth"})}let u;const _={id:"drawerReplies",width:"mx-auto align-center content-center w-9/12",height:"h-2/3",padding:"p-4",position:"bottom",meta:{msgs:[],users:i,mid:u,reply:w,like:$},rounded:"rounded-xl"};async function m(){const c=await se(o.cid);c.forEach(async P=>{Object.keys(i).includes(P.author)||e(1,i=(await te(o.cid)).users)}),e(3,l=c)}async function $(c){await Te(o.cid,c),setTimeout(m,1e3)}function k(c){u=c,_.meta.msgs=[];for(const P of l[c].replies)_.meta.msgs.push(l[P]);_.meta.users=i,_.meta.mid=c,ee.open(_)}async function T(c){await oe(o.cid,c),setTimeout(m,1e3)}async function w(c,P){await oe(o.cid,c,P),setTimeout(async()=>{await m(),ee.close(),k(_.meta.mid)},1e3)}be(async()=>{o.token||ye("Sign in to a class first!",()=>{we(ge+"/classes")});const c=await te(o.cid);e(2,n=c.name),e(1,i=c.users),e(3,l=await se(o.cid)),setInterval(m,1e3*60),f(),e(0,s.style.maxHeight=d().toString()+"px",s),e(0,s.style.minHeight=d().toString()+"px",s)});function M(c){G[c?"unshift":"push"](()=>{a=c,e(4,a)})}function L(c){G[c?"unshift":"push"](()=>{p=c,e(5,p)})}const D=c=>{$(c)},O=c=>{k(c)},h=c=>{$(c)};function b(c){G[c?"unshift":"push"](()=>{s=c,e(0,s)})}return[s,i,n,l,a,p,o,$,k,T,w,M,L,D,O,h,b]}class ze extends he{constructor(t){super(),pe(this,t,Pe,Me,ce,{})}}export{ze as component};
