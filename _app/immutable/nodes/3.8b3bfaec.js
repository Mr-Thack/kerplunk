import{s as pe,f as C,a as A,l as W,g as $,h as N,c as I,m as L,d as T,j as E,U as v,i as O,u as m,n as q,T as ve,C as Ee,I as Ne,o as De,S as He,p as ee,e as X,R as Me,K as B}from"../chunks/scheduler.2996579b.js";import{S as we,i as be,a as y,g as Y,t as D,c as G,b as z,d as F,m as J,e as Q}from"../chunks/index.00b56f8c.js";import{e as oe}from"../chunks/each.4e61ef43.js";import{a as ke,K as Se,d as Ue}from"../chunks/KTextArea.bc1fedbc.js";import{u as ae}from"../chunks/stores.0e991afd.js";import{g as je}from"../chunks/navigation.dcad6988.js";import{f as Ae}from"../chunks/alerts.73a0c392.js";import{b as Te}from"../chunks/paths.cbfeffab.js";import{g as ie,a as Ie,s as Re,b as We}from"../chunks/convo.479b689e.js";function le(n){let e,r;return e=new ke({props:{src:n[1]}}),{c(){z(e.$$.fragment)},l(t){F(e.$$.fragment,t)},m(t,s){J(e,t,s),r=!0},p(t,s){const f={};s&2&&(f.src=t[1]),e.$set(f)},i(t){r||(y(e.$$.fragment,t),r=!0)},o(t){D(e.$$.fragment,t),r=!1},d(t){Q(e,t)}}}function fe(n){let e,r;return e=new ke({props:{src:n[1]}}),{c(){z(e.$$.fragment)},l(t){F(e.$$.fragment,t)},m(t,s){J(e,t,s),r=!0},p(t,s){const f={};s&2&&(f.src=t[1]),e.$set(f)},i(t){r||(y(e.$$.fragment,t),r=!0)},o(t){D(e.$$.fragment,t),r=!1},d(t){Q(e,t)}}}function Le(n){let e,r,t,s,f,o=n[2].author+"",l,a,d,g=n[2].humanTime()+"",S,H,w,b=n[2].text+"",k,j,_,u=!n[0]&&le(n),h=n[0]&&fe(n);return{c(){e=C("div"),u&&u.c(),r=A(),t=C("div"),s=C("header"),f=C("p"),l=W(o),a=A(),d=C("p"),S=W(g),H=A(),w=C("p"),k=W(b),j=A(),h&&h.c(),this.h()},l(i){e=$(i,"DIV",{class:!0});var c=N(e);u&&u.l(c),r=I(c),t=$(c,"DIV",{class:!0});var R=N(t);s=$(R,"HEADER",{class:!0});var M=N(s);f=$(M,"P",{class:!0});var K=N(f);l=L(K,o),K.forEach(T),a=I(M),d=$(M,"P",{class:!0});var p=N(d);S=L(p,g),p.forEach(T),M.forEach(T),H=I(R),w=$(R,"P",{class:!0});var P=N(w);k=L(P,b),P.forEach(T),R.forEach(T),j=I(c),h&&h.l(c),c.forEach(T),this.h()},h(){E(f,"class","font-bold text-xs lg:text-base mr-4"),E(d,"class","text-xs lg:text-base"),E(s,"class","flex justify-between items-center"),E(w,"class","text-xs lg:text-base"),E(t,"class","card p-2 lg:p-4 space-y-2"),v(t,"rounded-tr-none",n[0]),v(t,"rounded-tl-none",!n[0]),v(t,"variant-filled-primary",n[0]),v(t,"variant-soft",!n[0]),E(e,"class","grid lg:gap-2"),v(e,"grid-cols-[1fr_auto_auto]",n[0]),v(e,"grid-cols-[auto_auto_1fr]",!n[0]),v(e,"justify-items-end",n[0]),v(e,"text-right",n[0]),v(e,"text-left",!n[0])},m(i,c){O(i,e,c),u&&u.m(e,null),m(e,r),m(e,t),m(t,s),m(s,f),m(f,l),m(s,a),m(s,d),m(d,S),m(t,H),m(t,w),m(w,k),m(e,j),h&&h.m(e,null),_=!0},p(i,[c]){i[0]?u&&(Y(),D(u,1,1,()=>{u=null}),G()):u?(u.p(i,c),c&1&&y(u,1)):(u=le(i),u.c(),y(u,1),u.m(e,r)),(!_||c&4)&&o!==(o=i[2].author+"")&&q(l,o),(!_||c&4)&&g!==(g=i[2].humanTime()+"")&&q(S,g),(!_||c&4)&&b!==(b=i[2].text+"")&&q(k,b),(!_||c&1)&&v(t,"rounded-tr-none",i[0]),(!_||c&1)&&v(t,"rounded-tl-none",!i[0]),(!_||c&1)&&v(t,"variant-filled-primary",i[0]),(!_||c&1)&&v(t,"variant-soft",!i[0]),i[0]?h?(h.p(i,c),c&1&&y(h,1)):(h=fe(i),h.c(),y(h,1),h.m(e,null)):h&&(Y(),D(h,1,1,()=>{h=null}),G()),(!_||c&1)&&v(e,"grid-cols-[1fr_auto_auto]",i[0]),(!_||c&1)&&v(e,"grid-cols-[auto_auto_1fr]",!i[0]),(!_||c&1)&&v(e,"justify-items-end",i[0]),(!_||c&1)&&v(e,"text-right",i[0]),(!_||c&1)&&v(e,"text-left",!i[0])},i(i){_||(y(u),y(h),_=!0)},o(i){D(u),D(h),_=!1},d(i){i&&T(e),u&&u.d(),h&&h.d()}}}function Oe(n,e,r){let{isThisUser:t}=e,{src:s}=e,{msg:f}=e;return n.$$set=o=>{"isThisUser"in o&&r(0,t=o.isThisUser),"src"in o&&r(1,s=o.src),"msg"in o&&r(2,f=o.msg)},[t,s,f]}class Pe extends we{constructor(e){super(),be(this,e,Oe,Le,pe,{isThisUser:0,src:1,msg:2})}}var Ke=Object.defineProperty,Ve=(n,e)=>{for(var r in e)Ke(n,r,{get:e[r],enumerable:!0})},ye=(n,e,r)=>{if(!e.has(n))throw TypeError("Cannot "+r)},ce=(n,e,r)=>(ye(n,e,"read from private field"),r?r.call(n):e.get(n)),qe=(n,e,r)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,r)},Be=(n,e,r,t)=>(ye(n,e,"write to private field"),t?t.call(n,r):e.set(n,r),r),Ye={};Ve(Ye,{Channel:()=>Ce,PluginListener:()=>$e,addPluginListener:()=>ze,convertFileSrc:()=>Fe,invoke:()=>x,transformCallback:()=>Z});function Ge(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function Z(n,e=!1){let r=Ge(),t=`_${r}`;return Object.defineProperty(window,t,{value:s=>(e&&Reflect.deleteProperty(window,t),n==null?void 0:n(s)),writable:!1,configurable:!0}),r}var V,Ce=class{constructor(){this.__TAURI_CHANNEL_MARKER__=!0,qe(this,V,()=>{}),this.id=Z(n=>{ce(this,V).call(this,n)})}set onmessage(n){Be(this,V,n)}get onmessage(){return ce(this,V)}toJSON(){return`__CHANNEL__:${this.id}`}};V=new WeakMap;var $e=class{constructor(n,e,r){this.plugin=n,this.event=e,this.channelId=r}async unregister(){return x(`plugin:${this.plugin}|remove_listener`,{event:this.event,channelId:this.channelId})}};async function ze(n,e,r){let t=new Ce;return t.onmessage=r,x(`plugin:${n}|register_listener`,{event:e,handler:t}).then(()=>new $e(n,e,t.id))}async function x(n,e={}){return new Promise((r,t)=>{let s=Z(o=>{r(o),Reflect.deleteProperty(window,`_${f}`)},!0),f=Z(o=>{t(o),Reflect.deleteProperty(window,`_${s}`)},!0);window.__TAURI_IPC__({cmd:n,callback:s,error:f,...e})})}function Fe(n,e="asset"){let r=encodeURIComponent(n);return navigator.userAgent.includes("Windows")?`https://${e}.localhost/${r}`:`${e}://localhost/${r}`}var ue;(function(n){n.Year="Year",n.Month="Month",n.TwoWeeks="TwoWeeks",n.Week="Week",n.Day="Day",n.Hour="Hour",n.Minute="Minute",n.Second="Second"})(ue||(ue={}));var he;(function(n){n[n.None=0]="None",n[n.Min=1]="Min",n[n.Low=2]="Low",n[n.Default=3]="Default",n[n.High=4]="High"})(he||(he={}));var de;(function(n){n[n.Secret=-1]="Secret",n[n.Private=0]="Private",n[n.Public=1]="Public"})(de||(de={}));async function Je(){return window.Notification.permission!=="default"?Promise.resolve(window.Notification.permission==="granted"):x("plugin:notification|is_permission_granted")}async function Qe(){return window.Notification.requestPermission()}function Xe(n){typeof n=="string"?new window.Notification(n):new window.Notification(n.title,n)}function me(n,e,r){const t=n.slice();return t[18]=e[r],t}function Ze(n){let e,r,t=oe(n[4]),s=[];for(let o=0;o<t.length;o+=1)s[o]=ge(me(n,t,o));const f=o=>D(s[o],1,1,()=>{s[o]=null});return{c(){for(let o=0;o<s.length;o+=1)s[o].c();e=X()},l(o){for(let l=0;l<s.length;l+=1)s[l].l(o);e=X()},m(o,l){for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(o,l);O(o,e,l),r=!0},p(o,l){if(l&50){t=oe(o[4]);let a;for(a=0;a<t.length;a+=1){const d=me(o,t,a);s[a]?(s[a].p(d,l),y(s[a],1)):(s[a]=ge(d),s[a].c(),y(s[a],1),s[a].m(e.parentNode,e))}for(Y(),a=t.length;a<s.length;a+=1)f(a);G()}},i(o){if(!r){for(let l=0;l<t.length;l+=1)y(s[l]);r=!0}},o(o){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)D(s[l]);r=!1},d(o){o&&T(e),Me(s,o)}}}function xe(n){let e,r="Please Wait...";return{c(){e=C("p"),e.textContent=r,this.h()},l(t){e=$(t,"P",{class:!0,["data-svelte-h"]:!0}),ve(e)!=="svelte-n9uvbj"&&(e.textContent=r),this.h()},h(){E(e,"class","p w-full")},m(t,s){O(t,e,s)},p:B,i:B,o:B,d(t){t&&T(e)}}}function et(n){let e,r;return e=new Pe({props:{isThisUser:!1,src:n[1][n[18].author].photo,msg:n[18]}}),{c(){z(e.$$.fragment)},l(t){F(e.$$.fragment,t)},m(t,s){J(e,t,s),r=!0},p(t,s){const f={};s&18&&(f.src=t[1][t[18].author].photo),s&16&&(f.msg=t[18]),e.$set(f)},i(t){r||(y(e.$$.fragment,t),r=!0)},o(t){D(e.$$.fragment,t),r=!1},d(t){Q(e,t)}}}function tt(n){let e,r;return e=new Pe({props:{isThisUser:!0,src:n[5].photo,msg:n[18]}}),{c(){z(e.$$.fragment)},l(t){F(e.$$.fragment,t)},m(t,s){J(e,t,s),r=!0},p(t,s){const f={};s&32&&(f.src=t[5].photo),s&16&&(f.msg=t[18]),e.$set(f)},i(t){r||(y(e.$$.fragment,t),r=!0)},o(t){D(e.$$.fragment,t),r=!1},d(t){Q(e,t)}}}function nt(n){let e,r,t,s=n[18].text+" - "+n[18].humanTime(),f,o;return{c(){e=C("div"),r=C("div"),t=C("p"),f=W(s),o=A(),this.h()},l(l){e=$(l,"DIV",{class:!0});var a=N(e);r=$(a,"DIV",{class:!0});var d=N(r);t=$(d,"P",{class:!0});var g=N(t);f=L(g,s),g.forEach(T),d.forEach(T),o=I(a),a.forEach(T),this.h()},h(){E(t,"class","text-xs lg:text-base"),E(r,"class","border-0 space-y-2 w-full mb-4 variant-filled-surface p-2 w-9/12 mx-auto rounded-xl"),E(e,"class","grid gap-4 text-center w-full")},m(l,a){O(l,e,a),m(e,r),m(r,t),m(t,f),m(e,o)},p(l,a){a&16&&s!==(s=l[18].text+" - "+l[18].humanTime())&&q(f,s)},i:B,o:B,d(l){l&&T(e)}}}function ge(n){let e,r,t,s;const f=[nt,tt,et],o=[];function l(a,d){return a[18].author==="SYSTEM"?0:a[18].author===a[5].name?1:2}return e=l(n),r=o[e]=f[e](n),{c(){r.c(),t=X()},l(a){r.l(a),t=X()},m(a,d){o[e].m(a,d),O(a,t,d),s=!0},p(a,d){let g=e;e=l(a),e===g?o[e].p(a,d):(Y(),D(o[g],1,1,()=>{o[g]=null}),G(),r=o[e],r?r.p(a,d):(r=o[e]=f[e](a),r.c()),y(r,1),r.m(t.parentNode,t))},i(a){s||(y(r),s=!0)},o(a){D(r),s=!1},d(a){a&&T(t),o[e].d(a)}}}function rt(n){let e,r,t,s,f,o,l=(n[5].convo?n[5].convo:"Loading...")+"",a,d,g,S="settings",H,w,b,k,j,_,u,h,i,c;const R=[xe,Ze],M=[];function K(p,P){return!p[5].name||!p[1]||!p[4].length?0:1}return b=K(n),k=M[b]=R[b](n),u=new Se({props:{onclick:n[6],ontype:n[7],sendOnEnter:!0}}),{c(){e=C("div"),r=C("div"),t=C("a"),s=W("arrow_back_ios"),f=A(),o=C("h3"),a=W(l),d=A(),g=C("button"),g.textContent=S,H=A(),w=C("section"),k.c(),j=A(),_=C("div"),z(u.$$.fragment),this.h()},l(p){e=$(p,"DIV",{class:!0});var P=N(e);r=$(P,"DIV",{class:!0});var U=N(r);t=$(U,"A",{class:!0,href:!0});var te=N(t);s=L(te,"arrow_back_ios"),te.forEach(T),f=I(U),o=$(U,"H3",{class:!0});var ne=N(o);a=L(ne,l),ne.forEach(T),d=I(U),g=$(U,"BUTTON",{class:!0,["data-svelte-h"]:!0}),ve(g)!=="svelte-qvcjja"&&(g.textContent=S),U.forEach(T),H=I(P),w=$(P,"SECTION",{class:!0});var re=N(w);k.l(re),re.forEach(T),j=I(P),_=$(P,"DIV",{});var se=N(_);F(u.$$.fragment,se),se.forEach(T),P.forEach(T),this.h()},h(){E(t,"class","btn-icon material-symbols-outlined w-8 h-8"),E(t,"href",Te+"/chatrooms"),E(o,"class","h3 px-2 my-auto"),E(g,"class","material-symbols-outlined ml-auto mr-3 w-8 h-8 my-auto"),E(r,"class","h-auto flex flex-row variant-filled-primary mt-4 p-1"),E(w,"class","p-1 overflow-y-auto space-y-4"),v(w,"placeholder",!n[4].length),v(w,"animate-pulse",!n[4].length),E(e,"class","flex flex-col overflow-hidden px-4 lg:pl-0")},m(p,P){O(p,e,P),m(e,r),m(r,t),m(t,s),m(r,f),m(r,o),m(o,a),m(r,d),m(r,g),n[9](r),m(e,H),m(e,w),M[b].m(w,null),n[10](w),m(e,j),m(e,_),J(u,_,null),n[11](_),h=!0,i||(c=Ee(g,"click",n[8]),i=!0)},p(p,[P]){(!h||P&32)&&l!==(l=(p[5].convo?p[5].convo:"Loading...")+"")&&q(a,l);let U=b;b=K(p),b===U?M[b].p(p,P):(Y(),D(M[U],1,1,()=>{M[U]=null}),G(),k=M[b],k?k.p(p,P):(k=M[b]=R[b](p),k.c()),y(k,1),k.m(w,null)),(!h||P&16)&&v(w,"placeholder",!p[4].length),(!h||P&16)&&v(w,"animate-pulse",!p[4].length)},i(p){h||(y(k),y(u.$$.fragment,p),h=!0)},o(p){D(k),D(u.$$.fragment,p),h=!1},d(p){p&&T(e),n[9](null),M[b].d(),n[10](null),Q(u),n[11](null),i=!1,c()}}}function _e(n){const e=n.offsetHeight,r=getComputedStyle(n),t=parseInt(r.getPropertyValue("margin-top")),s=parseInt(r.getPropertyValue("margin-bottom"));return e+t+s}function st(n,e,r){let t;Ne(n,ae,i=>r(5,t=i));let s;async function f(){s=await Je(),s||await Qe().then(i=>{s=i==="granted"})}f();let o;var l,a,d,g;function S(){o?o.scrollTo({top:o.scrollHeight,behavior:"smooth"}):console.log(o)}var H=[];async function w(i){await We(t.cid,i)}function b(){return window.innerHeight-_e(d)-_e(g)-1}function k(){r(0,o.style.maxHeight=b().toString()+"px",o),r(0,o.style.height=b().toString()+"px",o)}De(async()=>{k(),t.token||Ae("Open a chatroom first!",()=>{je(Te+"/chatrooms")});const i=await ie(t.cid);r(1,l=i.users),He(ae,t.convo=i.name,t),a=i.owner,r(4,H=await Ie(t.cid)),setTimeout(S,150),Re(t.cid,async c=>{Object.keys(l).includes(c.author)||r(1,l=(await ie(t.cid)).users),r(4,H=[...H,c]),s&&Xe({title:c.author,body:c.text}),setTimeout(S,75)},H.length),window.addEventListener("resize",()=>{try{k()}catch{}})});async function j(){var i;window.innerWidth<=639?i={id:"drawerChat",width:"w-screen",height:"h-[220px]",padding:"p-4",rounded:"rounded-xl",position:"top",meta:{owner:t.name===a,cid:t.cid}}:window.innerWidth<=1024?i={id:"drawerChat",width:"w-[340px]",height:"h-full",padding:"p-4",rounded:"rounded-xl",position:"right",meta:{owner:t.name===a,cid:t.cid}}:i={id:"drawerChat",width:"w-[280px] md:w-[480px]",padding:"p-4",rounded:"rounded-xl",position:"right",meta:{owner:t.name===a,cid:t.cid}},Ue.open(i)}function _(i){ee[i?"unshift":"push"](()=>{d=i,r(2,d)})}function u(i){ee[i?"unshift":"push"](()=>{o=i,r(0,o)})}function h(i){ee[i?"unshift":"push"](()=>{g=i,r(3,g)})}return[o,l,d,g,H,t,w,k,j,_,u,h]}class mt extends we{constructor(e){super(),be(this,e,st,rt,pe,{})}}export{mt as component};
