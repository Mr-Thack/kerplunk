import{s as ce,f as E,l as Q,g as $,h as P,m as X,d as _,j as I,i as H,u as w,n as fe,K as L,a as N,c as K,T as ue,U as A,I as ge,o as be,p as J,e as B,R as me}from"../chunks/scheduler.2996579b.js";import{S as he,i as pe,b as q,d as z,m as F,t as S,c as W,a as y,e as Y,g as G}from"../chunks/index.00b56f8c.js";import{e as U}from"../chunks/each.4e61ef43.js";import{K as _e}from"../chunks/KPost.6ede0916.js";import{K as ke,d as ee}from"../chunks/KTextArea.bc1fedbc.js";import{u as ve}from"../chunks/stores.0e991afd.js";import{g as we}from"../chunks/navigation.f4fa423a.js";import{f as ye}from"../chunks/alerts.73a0c392.js";import{b as de}from"../chunks/paths.cd3d196f.js";import{g as te,a as se,l as Te,b as oe}from"../chunks/convo.bbe58ce1.js";function Ee(r){let e,t,s,o=r[0].text+" - "+r[0].humanTime(),i;return{c(){e=E("div"),t=E("div"),s=E("p"),i=Q(o),this.h()},l(n){e=$(n,"DIV",{class:!0});var l=P(e);t=$(l,"DIV",{class:!0});var a=P(t);s=$(a,"P",{});var p=P(s);i=X(p,o),p.forEach(_),a.forEach(_),l.forEach(_),this.h()},h(){I(t,"class","border-0 space-y-2 w-full mt-4 variant-filled-surface p-2 w-9/12 mx-auto rounded-xl"),I(e,"class","grid gap-4 text-center mx-auto")},m(n,l){H(n,e,l),w(e,t),w(t,s),w(s,i)},p(n,[l]){l&1&&o!==(o=n[0].text+" - "+n[0].humanTime())&&fe(i,o)},i:L,o:L,d(n){n&&_(e)}}}function $e(r,e,t){let{msg:s}=e;return r.$$set=o=>{"msg"in o&&t(0,s=o.msg)},[s]}class Ie extends he{constructor(e){super(),pe(this,e,$e,Ee,ce,{msg:0})}}function ne(r,e,t){const s=r.slice();return s[23]=e[t],s[25]=t,s}function le(r,e,t){const s=r.slice();return s[10]=e[t],s[27]=t,s}function Se(r){let e,t,s=U(r[3]),o=[];for(let n=0;n<s.length;n+=1)o[n]=ae(ne(r,s,n));const i=n=>S(o[n],1,1,()=>{o[n]=null});return{c(){for(let n=0;n<o.length;n+=1)o[n].c();e=B()},l(n){for(let l=0;l<o.length;l+=1)o[l].l(n);e=B()},m(n,l){for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(n,l);H(n,e,l),t=!0},p(n,l){if(l&394){s=U(n[3]);let a;for(a=0;a<s.length;a+=1){const p=ne(n,s,a);o[a]?(o[a].p(p,l),y(o[a],1)):(o[a]=ae(p),o[a].c(),y(o[a],1),o[a].m(e.parentNode,e))}for(G(),a=s.length;a<o.length;a+=1)i(a);W()}},i(n){if(!t){for(let l=0;l<s.length;l+=1)y(o[l]);t=!0}},o(n){o=o.filter(Boolean);for(let l=0;l<o.length;l+=1)S(o[l]);t=!1},d(n){n&&_(e),me(o,n)}}}function Ce(r){let e,t="Please Wait...";return{c(){e=E("p"),e.textContent=t,this.h()},l(s){e=$(s,"P",{class:!0,["data-svelte-h"]:!0}),ue(e)!=="svelte-19o54u0"&&(e.textContent=t),this.h()},h(){I(e,"class","p")},m(s,o){H(s,e,o)},p:L,i:L,o:L,d(s){s&&_(e)}}}function He(r){let e,t,s,o,i,n=U(r[23].replies),l=[];for(let c=0;c<n.length;c+=1)l[c]=re(le(r,n,c));const a=c=>S(l[c],1,1,()=>{l[c]=null});function p(){return r[14](r[25])}function k(){return r[15](r[25])}return t=new _e({props:{src:r[1][r[23].author].photo,msg:r[23],reply:p,like:k}}),{c(){for(let c=0;c<l.length;c+=1)l[c].c();e=N(),q(t.$$.fragment),s=N(),o=E("hr"),this.h()},l(c){for(let m=0;m<l.length;m+=1)l[m].l(c);e=K(c),z(t.$$.fragment,c),s=K(c),o=$(c,"HR",{class:!0}),this.h()},h(){I(o,"class","border-4 rounded-full drop-shadow-xl")},m(c,m){for(let d=0;d<l.length;d+=1)l[d]&&l[d].m(c,m);H(c,e,m),F(t,c,m),H(c,s,m),H(c,o,m),i=!0},p(c,m){if(r=c,m&138){n=U(r[23].replies);let u;for(u=0;u<n.length;u+=1){const D=le(r,n,u);l[u]?(l[u].p(D,m),y(l[u],1)):(l[u]=re(D),l[u].c(),y(l[u],1),l[u].m(e.parentNode,e))}for(G(),u=n.length;u<l.length;u+=1)a(u);W()}const d={};m&10&&(d.src=r[1][r[23].author].photo),m&8&&(d.msg=r[23]),t.$set(d)},i(c){if(!i){for(let m=0;m<n.length;m+=1)y(l[m]);y(t.$$.fragment,c),i=!0}},o(c){l=l.filter(Boolean);for(let m=0;m<l.length;m+=1)S(l[m]);S(t.$$.fragment,c),i=!1},d(c){c&&(_(e),_(s),_(o)),me(l,c),Y(t,c)}}}function De(r){let e,t,s,o;return e=new Ie({props:{msg:r[23]}}),{c(){q(e.$$.fragment),t=N(),s=E("hr"),this.h()},l(i){z(e.$$.fragment,i),t=K(i),s=$(i,"HR",{class:!0}),this.h()},h(){I(s,"class","border-4 rounded-full drop-shadow-xl")},m(i,n){F(e,i,n),H(i,t,n),H(i,s,n),o=!0},p(i,n){const l={};n&8&&(l.msg=i[23]),e.$set(l)},i(i){o||(y(e.$$.fragment,i),o=!0)},o(i){S(e.$$.fragment,i),o=!1},d(i){i&&(_(t),_(s)),Y(e,i)}}}function Ve(r){let e,t,s,o;function i(){return r[13](r[10])}return t=new _e({props:{src:r[1][r[3][r[10]].author].photo,msg:r[3][r[10]],isReply:!0,like:i}}),{c(){e=E("div"),q(t.$$.fragment),s=N(),this.h()},l(n){e=$(n,"DIV",{class:!0});var l=P(e);z(t.$$.fragment,l),s=K(l),l.forEach(_),this.h()},h(){I(e,"class","w-9/12 mx-auto align-center")},m(n,l){H(n,e,l),F(t,e,null),w(e,s),o=!0},p(n,l){r=n;const a={};l&10&&(a.src=r[1][r[3][r[10]].author].photo),l&8&&(a.msg=r[3][r[10]]),l&8&&(a.like=i),t.$set(a)},i(n){o||(y(t.$$.fragment,n),o=!0)},o(n){S(t.$$.fragment,n),o=!1},d(n){n&&_(e),Y(t)}}}function re(r){let e,t,s=r[27]<3&&Ve(r);return{c(){s&&s.c(),e=B()},l(o){s&&s.l(o),e=B()},m(o,i){s&&s.m(o,i),H(o,e,i),t=!0},p(o,i){o[27]<3&&s.p(o,i)},i(o){t||(y(s),t=!0)},o(o){S(s),t=!1},d(o){o&&_(e),s&&s.d(o)}}}function ae(r){let e,t,s,o;const i=[De,He],n=[];function l(a,p){return a[23].author==="SYSTEM"?0:a[23].replyTo?-1:1}return~(e=l(r))&&(t=n[e]=i[e](r)),{c(){t&&t.c(),s=B()},l(a){t&&t.l(a),s=B()},m(a,p){~e&&n[e].m(a,p),H(a,s,p),o=!0},p(a,p){let k=e;e=l(a),e===k?~e&&n[e].p(a,p):(t&&(G(),S(n[k],1,1,()=>{n[k]=null}),W()),~e?(t=n[e],t?t.p(a,p):(t=n[e]=i[e](a),t.c()),y(t,1),t.m(s.parentNode,s)):t=null)},i(a){o||(y(t),o=!0)},o(a){S(t),o=!1},d(a){a&&_(s),~e&&n[e].d(a)}}}function Me(r){let e,t,s,o,i,n,l=r[2]?"Classroom "+r[2]:"Loading...",a,p,k,c="settings",m,d,u,D,g,v,T,V;u=new ke({props:{onclick:r[9],sendOnEnter:!1}});const O=[Ce,Se],M=[];function j(h,b){return!h[6].name||!h[1]||!h[3].length?0:1}return v=j(r),T=M[v]=O[v](r),{c(){e=E("div"),t=E("div"),s=E("a"),o=Q("arrow_back_ios"),i=N(),n=E("h3"),a=Q(l),p=N(),k=E("button"),k.textContent=c,m=N(),d=E("div"),q(u.$$.fragment),D=N(),g=E("section"),T.c(),this.h()},l(h){e=$(h,"DIV",{class:!0});var b=P(e);t=$(b,"DIV",{class:!0});var C=P(t);s=$(C,"A",{class:!0,href:!0});var f=P(s);o=X(f,"arrow_back_ios"),f.forEach(_),i=K(C),n=$(C,"H3",{class:!0});var R=P(n);a=X(R,l),R.forEach(_),p=K(C),k=$(C,"BUTTON",{class:!0,["data-svelte-h"]:!0}),ue(k)!=="svelte-1o7k9cj"&&(k.textContent=c),C.forEach(_),m=K(b),d=$(b,"DIV",{});var Z=P(d);z(u.$$.fragment,Z),Z.forEach(_),D=K(b),g=$(b,"SECTION",{class:!0});var x=P(g);T.l(x),x.forEach(_),b.forEach(_),this.h()},h(){I(s,"class","btn-icon material-symbols-outlined w-8 h-8"),I(s,"href",de+"/classrooms"),I(n,"class","h3 px-2 my-auto"),I(k,"class","material-symbols-outlined ml-auto mr-3 w-8 h-8 my-auto"),I(t,"class","h-auto flex flex-row variant-filled-primary mt-4 p-1"),I(g,"class","flex flex-col-reverse p-4 overflow-y-auto space-y-4 mb-8"),A(g,"placeholder",!r[3].length),A(g,"animate-pulse",!r[3].length),I(e,"class","flex flex-col max-h-screen overflow-hidden px-4 lg:pl-0")},m(h,b){H(h,e,b),w(e,t),w(t,s),w(s,o),w(t,i),w(t,n),w(n,a),w(t,p),w(t,k),r[11](t),w(e,m),w(e,d),F(u,d,null),r[12](d),w(e,D),w(e,g),M[v].m(g,null),r[16](g),V=!0},p(h,[b]){(!V||b&4)&&l!==(l=h[2]?"Classroom "+h[2]:"Loading...")&&fe(a,l);let C=v;v=j(h),v===C?M[v].p(h,b):(G(),S(M[C],1,1,()=>{M[C]=null}),W(),T=M[v],T?T.p(h,b):(T=M[v]=O[v](h),T.c()),y(T,1),T.m(g,null)),(!V||b&8)&&A(g,"placeholder",!h[3].length),(!V||b&8)&&A(g,"animate-pulse",!h[3].length)},i(h){V||(y(u.$$.fragment,h),y(T),V=!0)},o(h){S(u.$$.fragment,h),S(T),V=!1},d(h){h&&_(e),r[11](null),Y(u),r[12](null),M[v].d(),r[16](null)}}}function ie(r){const e=r.offsetHeight,t=getComputedStyle(r),s=parseInt(t.getPropertyValue("margin-top")),o=parseInt(t.getPropertyValue("margin-bottom"));return e+s+o}function Pe(r,e,t){let s;ge(r,ve,f=>t(6,s=f));let o;var i={};let n;var l=[],a,p;function k(){return window.innerHeight-ie(a)-ie(p)-32}function c(){t(0,o.style.maxHeight=k().toString()+"px",o),t(0,o.style.height=k().toString()+"px",o)}window.addEventListener("resize",()=>{try{c()}catch{}});function m(){o.scrollTo({top:-o.scrollHeight,behavior:"smooth"})}let d;const u={id:"drawerReplies",width:"mx-auto align-center content-center w-9/12",height:"h-2/3",padding:"p-4",position:"bottom",meta:{msgs:[],users:i,mid:d,reply:V,like:g},rounded:"rounded-xl"};async function D(){const f=await se(s.cid);f.forEach(async R=>{Object.keys(i).includes(R.author)||t(1,i=(await te(s.cid)).users)}),t(3,l=f)}async function g(f){await Te(s.cid,f),setTimeout(D,1e3)}function v(f){d=f,u.meta.msgs=[];for(const R of l[f].replies)u.meta.msgs.push(l[R]);u.meta.users=i,u.meta.mid=f,ee.open(u)}async function T(f){await oe(s.cid,f),setTimeout(D,1e3)}async function V(f,R){await oe(s.cid,f,R),setTimeout(async()=>{await D(),ee.close(),v(u.meta.mid)},1e3)}be(async()=>{s.token||ye("Sign in to a class first!",()=>{we(de+"/classes")});const f=await te(s.cid);t(2,n=f.name),t(1,i=f.users),t(3,l=await se(s.cid)),setInterval(D,1e3*60),m(),c()});function O(f){J[f?"unshift":"push"](()=>{a=f,t(4,a)})}function M(f){J[f?"unshift":"push"](()=>{p=f,t(5,p)})}const j=f=>{g(f)},h=f=>{v(f)},b=f=>{g(f)};function C(f){J[f?"unshift":"push"](()=>{o=f,t(0,o)})}return[o,i,n,l,a,p,s,g,v,T,V,O,M,j,h,b,C]}class ze extends he{constructor(e){super(),pe(this,e,Pe,Me,ce,{})}}export{ze as component};
