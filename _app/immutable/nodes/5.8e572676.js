import{s as ue,f as v,a as K,l as q,g as k,h as T,d as p,c as M,m as z,T as ae,j as b,i as O,u,C as De,n as Y,K as G,U as re,I as Ne,o as Ae,p as fe,e as J,R as Ve}from"../chunks/scheduler.2996579b.js";import{S as he,i as me,b as Q,d as X,m as Z,a as V,t as j,e as $,c as oe,g as ie}from"../chunks/index.00b56f8c.js";import{e as ne}from"../chunks/each.4e61ef43.js";import{K as Ke}from"../chunks/KPost.41375ccf.js";import{a as Me,K as Oe,d as be}from"../chunks/KTextArea.bc1fedbc.js";import{u as je}from"../chunks/stores.0e991afd.js";import{g as xe}from"../chunks/navigation.0f370f62.js";import{f as Be}from"../chunks/alerts.73a0c392.js";import{b as He}from"../chunks/paths.aacb0ce7.js";import{g as ye,a as we,l as Le,c as Ee}from"../chunks/convo.c056b6c4.js";function Ce(a){let e,t="Replies",s,l;return{c(){e=v("span"),e.textContent=t,this.h()},l(i){e=k(i,"SPAN",{class:!0,["data-svelte-h"]:!0}),ae(e)!=="svelte-vuuywk"&&(e.textContent=t),this.h()},h(){b(e,"class","chip variant-filled-secondary hover:variant-filled text-center")},m(i,r){O(i,e,r),s||(l=De(e,"click",a[6]),s=!0)},p:G,d(i){i&&p(e),s=!1,l()}}}function Fe(a){let e,t,s,l,i,r,n,o,_=a[0].author+"",d,c,h,y=a[0].elapsedTime()+"",m,H,w,E=a[0].text+"",S,N,A,I,F,g=a[0].likes+"",C,P,f,B="favorite",W,L,ce,pe;l=new Me({props:{src:a[1]}});let D=!a[2]&&Ce(a);return{c(){e=v("div"),t=v("header"),s=v("div"),Q(l.$$.fragment),i=K(),r=v("div"),n=v("div"),o=v("p"),d=q(_),c=K(),h=v("p"),m=q(y),H=K(),w=v("p"),S=q(E),N=K(),A=v("footer"),I=v("span"),F=v("p"),C=q(g),P=K(),f=v("span"),f.textContent=B,W=K(),D&&D.c(),this.h()},l(R){e=k(R,"DIV",{class:!0});var x=T(e);t=k(x,"HEADER",{class:!0});var U=T(t);s=k(U,"DIV",{class:!0});var de=T(s);X(l.$$.fragment,de),de.forEach(p),i=M(U),r=k(U,"DIV",{class:!0});var ee=T(r);n=k(ee,"DIV",{class:!0});var te=T(n);o=k(te,"P",{class:!0});var _e=T(o);d=z(_e,_),_e.forEach(p),c=M(te),h=k(te,"P",{class:!0});var ge=T(h);m=z(ge,y),ge.forEach(p),te.forEach(p),H=M(ee),w=k(ee,"P",{class:!0});var ve=T(w);S=z(ve,E),ve.forEach(p),ee.forEach(p),U.forEach(p),N=M(x),A=k(x,"FOOTER",{class:!0});var le=T(A);I=k(le,"SPAN",{class:!0});var se=T(I);F=k(se,"P",{});var ke=T(F);C=z(ke,g),ke.forEach(p),P=M(se),f=k(se,"SPAN",{class:!0,["data-svelte-h"]:!0}),ae(f)!=="svelte-1plra0r"&&(f.textContent=B),se.forEach(p),W=M(le),D&&D.l(le),le.forEach(p),x.forEach(p),this.h()},h(){b(s,"class","flex-initial align-left my-auto"),b(o,"class","font-bold flex-grow mx-4"),b(h,"class","flex-initial align-right"),b(n,"class","flex flex-row"),b(w,"class","mx-4 my-2 text-center"),b(r,"class","flex flex-col p-2 space-x-4"),b(t,"class","flex flex-row px-auto py-1 rounded-t justify-center"),b(f,"class","material-symbols-outlined"),b(I,"class","chip variant-filled-error hover:variant-filled"),b(A,"class","flex flex-row place-content-evenly pb-4"),b(e,"class","card space-y-2 variant-soft grid text-left mx-auto")},m(R,x){O(R,e,x),u(e,t),u(t,s),Z(l,s,null),u(t,i),u(t,r),u(r,n),u(n,o),u(o,d),u(n,c),u(n,h),u(h,m),u(r,H),u(r,w),u(w,S),u(e,N),u(e,A),u(A,I),u(I,F),u(F,C),u(I,P),u(I,f),u(A,W),D&&D.m(A,null),L=!0,ce||(pe=De(I,"click",a[5]),ce=!0)},p(R,[x]){const U={};x&2&&(U.src=R[1]),l.$set(U),(!L||x&1)&&_!==(_=R[0].author+"")&&Y(d,_),(!L||x&1)&&y!==(y=R[0].elapsedTime()+"")&&Y(m,y),(!L||x&1)&&E!==(E=R[0].text+"")&&Y(S,E),(!L||x&1)&&g!==(g=R[0].likes+"")&&Y(C,g),R[2]?D&&(D.d(1),D=null):D?D.p(R,x):(D=Ce(R),D.c(),D.m(A,null))},i(R){L||(V(l.$$.fragment,R),L=!0)},o(R){j(l.$$.fragment,R),L=!1},d(R){R&&p(e),$(l),D&&D.d(),ce=!1,pe()}}}function Ue(a,e,t){let{msg:s}=e,{src:l}=e,{isReply:i=!1}=e,{reply:r=()=>{}}=e,{like:n=()=>{}}=e;const o=()=>n(),_=()=>r();return a.$$set=d=>{"msg"in d&&t(0,s=d.msg),"src"in d&&t(1,l=d.src),"isReply"in d&&t(2,i=d.isReply),"reply"in d&&t(3,r=d.reply),"like"in d&&t(4,n=d.like)},[s,l,i,r,n,o,_]}class qe extends he{constructor(e){super(),me(this,e,Ue,Fe,ue,{msg:0,src:1,isReply:2,reply:3,like:4})}}function ze(a){let e,t,s,l=a[0].text+" - "+a[0].humanTime(),i;return{c(){e=v("div"),t=v("div"),s=v("p"),i=q(l),this.h()},l(r){e=k(r,"DIV",{class:!0});var n=T(e);t=k(n,"DIV",{class:!0});var o=T(t);s=k(o,"P",{});var _=T(s);i=z(_,l),_.forEach(p),o.forEach(p),n.forEach(p),this.h()},h(){b(t,"class","border-0 space-y-2 w-full mt-4 variant-filled-surface p-2 w-9/12 mx-auto rounded-xl"),b(e,"class","grid gap-4 text-center mx-auto")},m(r,n){O(r,e,n),u(e,t),u(t,s),u(s,i)},p(r,[n]){n&1&&l!==(l=r[0].text+" - "+r[0].humanTime())&&Y(i,l)},i:G,o:G,d(r){r&&p(e)}}}function We(a,e,t){let{msg:s}=e;return a.$$set=l=>{"msg"in l&&t(0,s=l.msg)},[s]}class Ye extends he{constructor(e){super(),me(this,e,We,ze,ue,{msg:0})}}function Te(a,e,t){const s=a.slice();return s[23]=e[t],s[25]=t,s}function Ie(a,e,t){const s=a.slice();return s[10]=e[t],s[27]=t,s}function Ge(a){let e,t,s=ne(a[3]),l=[];for(let r=0;r<s.length;r+=1)l[r]=Re(Te(a,s,r));const i=r=>j(l[r],1,1,()=>{l[r]=null});return{c(){for(let r=0;r<l.length;r+=1)l[r].c();e=J()},l(r){for(let n=0;n<l.length;n+=1)l[n].l(r);e=J()},m(r,n){for(let o=0;o<l.length;o+=1)l[o]&&l[o].m(r,n);O(r,e,n),t=!0},p(r,n){if(n&394){s=ne(r[3]);let o;for(o=0;o<s.length;o+=1){const _=Te(r,s,o);l[o]?(l[o].p(_,n),V(l[o],1)):(l[o]=Re(_),l[o].c(),V(l[o],1),l[o].m(e.parentNode,e))}for(ie(),o=s.length;o<l.length;o+=1)i(o);oe()}},i(r){if(!t){for(let n=0;n<s.length;n+=1)V(l[n]);t=!0}},o(r){l=l.filter(Boolean);for(let n=0;n<l.length;n+=1)j(l[n]);t=!1},d(r){r&&p(e),Ve(l,r)}}}function Je(a){let e,t="Please Wait...";return{c(){e=v("p"),e.textContent=t,this.h()},l(s){e=k(s,"P",{class:!0,["data-svelte-h"]:!0}),ae(e)!=="svelte-19o54u0"&&(e.textContent=t),this.h()},h(){b(e,"class","p")},m(s,l){O(s,e,l)},p:G,i:G,o:G,d(s){s&&p(e)}}}function Qe(a){let e,t,s,l,i,r=ne(a[23].replies),n=[];for(let c=0;c<r.length;c+=1)n[c]=Se(Ie(a,r,c));const o=c=>j(n[c],1,1,()=>{n[c]=null});function _(){return a[14](a[25])}function d(){return a[15](a[25])}return t=new Ke({props:{src:a[1][a[23].author].photo,msg:a[23],reply:_,like:d}}),{c(){for(let c=0;c<n.length;c+=1)n[c].c();e=K(),Q(t.$$.fragment),s=K(),l=v("hr"),this.h()},l(c){for(let h=0;h<n.length;h+=1)n[h].l(c);e=M(c),X(t.$$.fragment,c),s=M(c),l=k(c,"HR",{class:!0}),this.h()},h(){b(l,"class","border-4 rounded-full drop-shadow-xl")},m(c,h){for(let y=0;y<n.length;y+=1)n[y]&&n[y].m(c,h);O(c,e,h),Z(t,c,h),O(c,s,h),O(c,l,h),i=!0},p(c,h){if(a=c,h&138){r=ne(a[23].replies);let m;for(m=0;m<r.length;m+=1){const H=Ie(a,r,m);n[m]?(n[m].p(H,h),V(n[m],1)):(n[m]=Se(H),n[m].c(),V(n[m],1),n[m].m(e.parentNode,e))}for(ie(),m=r.length;m<n.length;m+=1)o(m);oe()}const y={};h&10&&(y.src=a[1][a[23].author].photo),h&8&&(y.msg=a[23]),t.$set(y)},i(c){if(!i){for(let h=0;h<r.length;h+=1)V(n[h]);V(t.$$.fragment,c),i=!0}},o(c){n=n.filter(Boolean);for(let h=0;h<n.length;h+=1)j(n[h]);j(t.$$.fragment,c),i=!1},d(c){c&&(p(e),p(s),p(l)),Ve(n,c),$(t,c)}}}function Xe(a){let e,t,s,l;return e=new Ye({props:{msg:a[23]}}),{c(){Q(e.$$.fragment),t=K(),s=v("hr"),this.h()},l(i){X(e.$$.fragment,i),t=M(i),s=k(i,"HR",{class:!0}),this.h()},h(){b(s,"class","border-4 rounded-full drop-shadow-xl")},m(i,r){Z(e,i,r),O(i,t,r),O(i,s,r),l=!0},p(i,r){const n={};r&8&&(n.msg=i[23]),e.$set(n)},i(i){l||(V(e.$$.fragment,i),l=!0)},o(i){j(e.$$.fragment,i),l=!1},d(i){i&&(p(t),p(s)),$(e,i)}}}function Ze(a){let e,t,s,l;function i(){return a[13](a[10])}return t=new qe({props:{src:a[1][a[3][a[10]].author].photo,msg:a[3][a[10]],isReply:!0,like:i}}),{c(){e=v("div"),Q(t.$$.fragment),s=K(),this.h()},l(r){e=k(r,"DIV",{class:!0});var n=T(e);X(t.$$.fragment,n),s=M(n),n.forEach(p),this.h()},h(){b(e,"class","w-5/12 mx-auto align-center")},m(r,n){O(r,e,n),Z(t,e,null),u(e,s),l=!0},p(r,n){a=r;const o={};n&10&&(o.src=a[1][a[3][a[10]].author].photo),n&8&&(o.msg=a[3][a[10]]),n&8&&(o.like=i),t.$set(o)},i(r){l||(V(t.$$.fragment,r),l=!0)},o(r){j(t.$$.fragment,r),l=!1},d(r){r&&p(e),$(t)}}}function Se(a){let e,t,s=a[27]<3&&Ze(a);return{c(){s&&s.c(),e=J()},l(l){s&&s.l(l),e=J()},m(l,i){s&&s.m(l,i),O(l,e,i),t=!0},p(l,i){l[27]<3&&s.p(l,i)},i(l){t||(V(s),t=!0)},o(l){j(s),t=!1},d(l){l&&p(e),s&&s.d(l)}}}function Re(a){let e,t,s,l;const i=[Xe,Qe],r=[];function n(o,_){return o[23].author==="SYSTEM"?0:o[23].replyTo?-1:1}return~(e=n(a))&&(t=r[e]=i[e](a)),{c(){t&&t.c(),s=J()},l(o){t&&t.l(o),s=J()},m(o,_){~e&&r[e].m(o,_),O(o,s,_),l=!0},p(o,_){let d=e;e=n(o),e===d?~e&&r[e].p(o,_):(t&&(ie(),j(r[d],1,1,()=>{r[d]=null}),oe()),~e?(t=r[e],t?t.p(o,_):(t=r[e]=i[e](o),t.c()),V(t,1),t.m(s.parentNode,s)):t=null)},i(o){l||(V(t),l=!0)},o(o){j(t),l=!1},d(o){o&&p(s),~e&&r[e].d(o)}}}function $e(a){let e,t,s,l,i,r,n=a[2]?"Classroom "+a[2]:"Loading...",o,_,d,c="settings",h,y,m,H,w,E,S,N;m=new Oe({props:{onclick:a[9],sendOnEnter:!1}});const A=[Je,Ge],I=[];function F(g,C){return!g[6].name||!g[1]||!g[3].length?0:1}return E=F(a),S=I[E]=A[E](a),{c(){e=v("div"),t=v("div"),s=v("a"),l=q("arrow_back_ios"),i=K(),r=v("h3"),o=q(n),_=K(),d=v("button"),d.textContent=c,h=K(),y=v("div"),Q(m.$$.fragment),H=K(),w=v("section"),S.c(),this.h()},l(g){e=k(g,"DIV",{class:!0});var C=T(e);t=k(C,"DIV",{class:!0});var P=T(t);s=k(P,"A",{class:!0,href:!0});var f=T(s);l=z(f,"arrow_back_ios"),f.forEach(p),i=M(P),r=k(P,"H3",{class:!0});var B=T(r);o=z(B,n),B.forEach(p),_=M(P),d=k(P,"BUTTON",{class:!0,["data-svelte-h"]:!0}),ae(d)!=="svelte-1o7k9cj"&&(d.textContent=c),P.forEach(p),h=M(C),y=k(C,"DIV",{});var W=T(y);X(m.$$.fragment,W),W.forEach(p),H=M(C),w=k(C,"SECTION",{class:!0});var L=T(w);S.l(L),L.forEach(p),C.forEach(p),this.h()},h(){b(s,"class","btn-icon material-symbols-outlined w-8 h-8"),b(s,"href",He+"/classrooms"),b(r,"class","h3 px-2 my-auto"),b(d,"class","material-symbols-outlined ml-auto mr-3 w-8 h-8 my-auto"),b(t,"class","h-auto flex flex-row variant-filled-primary mt-4 p-1"),b(w,"class","flex flex-col-reverse p-4 overflow-y-auto space-y-4 mb-8"),re(w,"placeholder",!a[3].length),re(w,"animate-pulse",!a[3].length),b(e,"class","flex flex-col max-h-screen overflow-hidden px-4 lg:pl-0")},m(g,C){O(g,e,C),u(e,t),u(t,s),u(s,l),u(t,i),u(t,r),u(r,o),u(t,_),u(t,d),a[11](t),u(e,h),u(e,y),Z(m,y,null),a[12](y),u(e,H),u(e,w),I[E].m(w,null),a[16](w),N=!0},p(g,[C]){(!N||C&4)&&n!==(n=g[2]?"Classroom "+g[2]:"Loading...")&&Y(o,n);let P=E;E=F(g),E===P?I[E].p(g,C):(ie(),j(I[P],1,1,()=>{I[P]=null}),oe(),S=I[E],S?S.p(g,C):(S=I[E]=A[E](g),S.c()),V(S,1),S.m(w,null)),(!N||C&8)&&re(w,"placeholder",!g[3].length),(!N||C&8)&&re(w,"animate-pulse",!g[3].length)},i(g){N||(V(m.$$.fragment,g),V(S),N=!0)},o(g){j(m.$$.fragment,g),j(S),N=!1},d(g){g&&p(e),a[11](null),$(m),a[12](null),I[E].d(),a[16](null)}}}function Pe(a){const e=a.offsetHeight,t=getComputedStyle(a),s=parseInt(t.getPropertyValue("margin-top")),l=parseInt(t.getPropertyValue("margin-bottom"));return e+s+l}function et(a,e,t){let s;Ne(a,je,f=>t(6,s=f));let l;var i={};let r;var n=[],o,_;function d(){return window.innerHeight-Pe(o)-Pe(_)-32}function c(){t(0,l.style.maxHeight=d().toString()+"px",l),t(0,l.style.height=d().toString()+"px",l)}window.addEventListener("resize",()=>{try{c()}catch{}});function h(){l.scrollTo({top:-l.scrollHeight,behavior:"smooth"})}let y;const m={id:"drawerReplies",width:"mx-auto align-center content-center w-9/12",height:"h-2/3",padding:"p-4",position:"bottom",meta:{msgs:[],users:i,mid:y,reply:N,like:w},rounded:"rounded-xl"};async function H(){const f=await we(s.cid);f.forEach(async B=>{Object.keys(i).includes(B.author)||t(1,i=(await ye(s.cid)).users)}),t(3,n=f)}async function w(f){await Le(s.cid,f),setTimeout(H,1e3)}function E(f){y=f,m.meta.msgs=[];for(const B of n[f].replies)m.meta.msgs.push(n[B]);m.meta.users=i,m.meta.mid=f,be.open(m)}async function S(f){await Ee(s.cid,f),setTimeout(H,1e3)}async function N(f,B){await Ee(s.cid,f,B),setTimeout(async()=>{await H(),be.close(),E(m.meta.mid)},1e3)}Ae(async()=>{s.token||Be("Sign in to a class first!",()=>{xe(He+"/classes")});const f=await ye(s.cid);t(2,r=f.name),t(1,i=f.users),t(3,n=await we(s.cid)),setInterval(H,1e3*60),h(),c()});function A(f){fe[f?"unshift":"push"](()=>{o=f,t(4,o)})}function I(f){fe[f?"unshift":"push"](()=>{_=f,t(5,_)})}const F=f=>{w(f)},g=f=>{E(f)},C=f=>{w(f)};function P(f){fe[f?"unshift":"push"](()=>{l=f,t(0,l)})}return[l,i,r,n,o,_,s,w,E,S,N,A,I,F,g,C,P]}class ut extends he{constructor(e){super(),me(this,e,et,$e,ue,{})}}export{ut as component};
