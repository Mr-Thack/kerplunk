import{s as me,f as N,a as R,l as O,g as I,h as S,c as H,m as K,d as b,j as P,U as w,i as W,u as m,n as q,T as ge,C as Ee,I as Te,o as $e,S as Ne,p as ee,e as Z,R as Ie,K as z}from"../chunks/scheduler.2996579b.js";import{S as _e,i as pe,a as $,g as F,t as A,c as G,b as J,d as Y,m as Q,e as X}from"../chunks/index.00b56f8c.js";import{e as ae}from"../chunks/each.4e61ef43.js";import{a as ve,K as Pe,d as Se}from"../chunks/KTextArea.bc1fedbc.js";import{u as oe}from"../chunks/stores.0e991afd.js";import{g as Ae}from"../chunks/navigation.0f370f62.js";import{f as Ue}from"../chunks/alerts.73a0c392.js";import{b as we}from"../chunks/paths.aacb0ce7.js";import{g as ie,a as je,s as De,b as Me,c as Re}from"../chunks/convo.c056b6c4.js";function le(s){let e,n;return e=new ve({props:{src:s[1]}}),{c(){J(e.$$.fragment)},l(t){Y(e.$$.fragment,t)},m(t,r){Q(e,t,r),n=!0},p(t,r){const c={};r&2&&(c.src=t[1]),e.$set(c)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){A(e.$$.fragment,t),n=!1},d(t){X(e,t)}}}function ce(s){let e,n;return e=new ve({props:{src:s[1]}}),{c(){J(e.$$.fragment)},l(t){Y(e.$$.fragment,t)},m(t,r){Q(e,t,r),n=!0},p(t,r){const c={};r&2&&(c.src=t[1]),e.$set(c)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){A(e.$$.fragment,t),n=!1},d(t){X(e,t)}}}function He(s){let e,n,t,r,c,a=s[2].author+"",l,o,d,_=s[2].humanTime()+"",U,D,p,k=s[2].text+"",y,j,v,u=!s[0]&&le(s),h=s[0]&&ce(s);return{c(){e=N("div"),u&&u.c(),n=R(),t=N("div"),r=N("header"),c=N("p"),l=O(a),o=R(),d=N("p"),U=O(_),D=R(),p=N("p"),y=O(k),j=R(),h&&h.c(),this.h()},l(f){e=I(f,"DIV",{class:!0});var i=S(e);u&&u.l(i),n=H(i),t=I(i,"DIV",{class:!0});var C=S(t);r=I(C,"HEADER",{class:!0});var E=S(r);c=I(E,"P",{class:!0});var V=S(c);l=K(V,a),V.forEach(b),o=H(E),d=I(E,"P",{class:!0});var g=S(d);U=K(g,_),g.forEach(b),E.forEach(b),D=H(C),p=I(C,"P",{class:!0});var T=S(p);y=K(T,k),T.forEach(b),C.forEach(b),j=H(i),h&&h.l(i),i.forEach(b),this.h()},h(){P(c,"class","font-bold text-xs lg:text-base mr-4"),P(d,"class","text-xs lg:text-base"),P(r,"class","flex justify-between items-center"),P(p,"class","text-xs lg:text-base"),P(t,"class","card p-2 lg:p-4 space-y-2"),w(t,"rounded-tr-none",s[0]),w(t,"rounded-tl-none",!s[0]),w(t,"variant-filled-primary",s[0]),w(t,"variant-soft",!s[0]),P(e,"class","grid lg:gap-2"),w(e,"grid-cols-[1fr_auto_auto]",s[0]),w(e,"grid-cols-[auto_auto_1fr]",!s[0]),w(e,"justify-items-end",s[0]),w(e,"text-right",s[0]),w(e,"text-left",!s[0])},m(f,i){W(f,e,i),u&&u.m(e,null),m(e,n),m(e,t),m(t,r),m(r,c),m(c,l),m(r,o),m(r,d),m(d,U),m(t,D),m(t,p),m(p,y),m(e,j),h&&h.m(e,null),v=!0},p(f,[i]){f[0]?u&&(F(),A(u,1,1,()=>{u=null}),G()):u?(u.p(f,i),i&1&&$(u,1)):(u=le(f),u.c(),$(u,1),u.m(e,n)),(!v||i&4)&&a!==(a=f[2].author+"")&&q(l,a),(!v||i&4)&&_!==(_=f[2].humanTime()+"")&&q(U,_),(!v||i&4)&&k!==(k=f[2].text+"")&&q(y,k),(!v||i&1)&&w(t,"rounded-tr-none",f[0]),(!v||i&1)&&w(t,"rounded-tl-none",!f[0]),(!v||i&1)&&w(t,"variant-filled-primary",f[0]),(!v||i&1)&&w(t,"variant-soft",!f[0]),f[0]?h?(h.p(f,i),i&1&&$(h,1)):(h=ce(f),h.c(),$(h,1),h.m(e,null)):h&&(F(),A(h,1,1,()=>{h=null}),G()),(!v||i&1)&&w(e,"grid-cols-[1fr_auto_auto]",f[0]),(!v||i&1)&&w(e,"grid-cols-[auto_auto_1fr]",!f[0]),(!v||i&1)&&w(e,"justify-items-end",f[0]),(!v||i&1)&&w(e,"text-right",f[0]),(!v||i&1)&&w(e,"text-left",!f[0])},i(f){v||($(u),$(h),v=!0)},o(f){A(u),A(h),v=!1},d(f){f&&b(e),u&&u.d(),h&&h.d()}}}function Ve(s,e,n){let{isThisUser:t}=e,{src:r}=e,{msg:c}=e;return s.$$set=a=>{"isThisUser"in a&&n(0,t=a.isThisUser),"src"in a&&n(1,r=a.src),"msg"in a&&n(2,c=a.msg)},[t,r,c]}class be extends _e{constructor(e){super(),pe(this,e,Ve,He,me,{isThisUser:0,src:1,msg:2})}}var Le=Object.defineProperty,Oe=(s,e)=>{for(var n in e)Le(s,n,{get:e[n],enumerable:!0})},ke=(s,e,n)=>{if(!e.has(s))throw TypeError("Cannot "+n)},fe=(s,e,n)=>(ke(s,e,"read from private field"),n?n.call(s):e.get(s)),Ke=(s,e,n)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,n)},We=(s,e,n,t)=>(ke(s,e,"write to private field"),t?t.call(s,n):e.set(s,n),n),Be={};Oe(Be,{Channel:()=>ye,PluginListener:()=>Ce,addPluginListener:()=>ze,convertFileSrc:()=>Fe,invoke:()=>L,transformCallback:()=>x});function qe(){return window.crypto.getRandomValues(new Uint32Array(1))[0]}function x(s,e=!1){let n=qe(),t=`_${n}`;return Object.defineProperty(window,t,{value:r=>(e&&Reflect.deleteProperty(window,t),s==null?void 0:s(r)),writable:!1,configurable:!0}),n}var B,ye=class{constructor(){this.__TAURI_CHANNEL_MARKER__=!0,Ke(this,B,()=>{}),this.id=x(s=>{fe(this,B).call(this,s)})}set onmessage(s){We(this,B,s)}get onmessage(){return fe(this,B)}toJSON(){return`__CHANNEL__:${this.id}`}};B=new WeakMap;var Ce=class{constructor(s,e,n){this.plugin=s,this.event=e,this.channelId=n}async unregister(){return L(`plugin:${this.plugin}|remove_listener`,{event:this.event,channelId:this.channelId})}};async function ze(s,e,n){let t=new ye;return t.onmessage=n,L(`plugin:${s}|register_listener`,{event:e,handler:t}).then(()=>new Ce(s,e,t.id))}async function L(s,e={}){return new Promise((n,t)=>{let r=x(a=>{n(a),Reflect.deleteProperty(window,`_${c}`)},!0),c=x(a=>{t(a),Reflect.deleteProperty(window,`_${r}`)},!0);window.__TAURI_IPC__({cmd:s,callback:r,error:c,...e})})}function Fe(s,e="asset"){let n=encodeURIComponent(s);return navigator.userAgent.includes("Windows")?`https://${e}.localhost/${n}`:`${e}://localhost/${n}`}function ue(s,e,n){const t=s.slice();return t[19]=e[n],t}function Ge(s){let e,n,t=ae(s[4]),r=[];for(let a=0;a<t.length;a+=1)r[a]=he(ue(s,t,a));const c=a=>A(r[a],1,1,()=>{r[a]=null});return{c(){for(let a=0;a<r.length;a+=1)r[a].c();e=Z()},l(a){for(let l=0;l<r.length;l+=1)r[l].l(a);e=Z()},m(a,l){for(let o=0;o<r.length;o+=1)r[o]&&r[o].m(a,l);W(a,e,l),n=!0},p(a,l){if(l&50){t=ae(a[4]);let o;for(o=0;o<t.length;o+=1){const d=ue(a,t,o);r[o]?(r[o].p(d,l),$(r[o],1)):(r[o]=he(d),r[o].c(),$(r[o],1),r[o].m(e.parentNode,e))}for(F(),o=t.length;o<r.length;o+=1)c(o);G()}},i(a){if(!n){for(let l=0;l<t.length;l+=1)$(r[l]);n=!0}},o(a){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)A(r[l]);n=!1},d(a){a&&b(e),Ie(r,a)}}}function Je(s){let e,n="Please Wait...";return{c(){e=N("p"),e.textContent=n,this.h()},l(t){e=I(t,"P",{class:!0,["data-svelte-h"]:!0}),ge(e)!=="svelte-n9uvbj"&&(e.textContent=n),this.h()},h(){P(e,"class","p w-full")},m(t,r){W(t,e,r)},p:z,i:z,o:z,d(t){t&&b(e)}}}function Ye(s){let e,n;return e=new be({props:{isThisUser:!1,src:s[1][s[19].author].photo,msg:s[19]}}),{c(){J(e.$$.fragment)},l(t){Y(e.$$.fragment,t)},m(t,r){Q(e,t,r),n=!0},p(t,r){const c={};r&18&&(c.src=t[1][t[19].author].photo),r&16&&(c.msg=t[19]),e.$set(c)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){A(e.$$.fragment,t),n=!1},d(t){X(e,t)}}}function Qe(s){let e,n;return e=new be({props:{isThisUser:!0,src:s[5].photo,msg:s[19]}}),{c(){J(e.$$.fragment)},l(t){Y(e.$$.fragment,t)},m(t,r){Q(e,t,r),n=!0},p(t,r){const c={};r&32&&(c.src=t[5].photo),r&16&&(c.msg=t[19]),e.$set(c)},i(t){n||($(e.$$.fragment,t),n=!0)},o(t){A(e.$$.fragment,t),n=!1},d(t){X(e,t)}}}function Xe(s){let e,n,t,r=s[19].text+" - "+s[19].humanTime(),c,a;return{c(){e=N("div"),n=N("div"),t=N("p"),c=O(r),a=R(),this.h()},l(l){e=I(l,"DIV",{class:!0});var o=S(e);n=I(o,"DIV",{class:!0});var d=S(n);t=I(d,"P",{class:!0});var _=S(t);c=K(_,r),_.forEach(b),d.forEach(b),a=H(o),o.forEach(b),this.h()},h(){P(t,"class","text-xs lg:text-base"),P(n,"class","border-0 space-y-2 w-full mb-4 variant-filled-surface p-2 w-9/12 mx-auto rounded-xl"),P(e,"class","grid gap-4 text-center w-full")},m(l,o){W(l,e,o),m(e,n),m(n,t),m(t,c),m(e,a)},p(l,o){o&16&&r!==(r=l[19].text+" - "+l[19].humanTime())&&q(c,r)},i:z,o:z,d(l){l&&b(e)}}}function he(s){let e,n,t,r;const c=[Xe,Qe,Ye],a=[];function l(o,d){return o[19].author==="SYSTEM"?0:o[19].author===o[5].name?1:2}return e=l(s),n=a[e]=c[e](s),{c(){n.c(),t=Z()},l(o){n.l(o),t=Z()},m(o,d){a[e].m(o,d),W(o,t,d),r=!0},p(o,d){let _=e;e=l(o),e===_?a[e].p(o,d):(F(),A(a[_],1,1,()=>{a[_]=null}),G(),n=a[e],n?n.p(o,d):(n=a[e]=c[e](o),n.c()),$(n,1),n.m(t.parentNode,t))},i(o){r||($(n),r=!0)},o(o){A(n),r=!1},d(o){o&&b(t),a[e].d(o)}}}function Ze(s){let e,n,t,r,c,a,l=(s[5].convo?s[5].convo:"Loading...")+"",o,d,_,U="settings",D,p,k,y,j,v,u,h,f,i;const C=[Je,Ge],E=[];function V(g,T){return!g[5].name||!g[1]||!g[4].length?0:1}return k=V(s),y=E[k]=C[k](s),u=new Pe({props:{onclick:s[6],ontype:s[7],sendOnEnter:!0}}),{c(){e=N("div"),n=N("div"),t=N("a"),r=O("arrow_back_ios"),c=R(),a=N("h3"),o=O(l),d=R(),_=N("button"),_.textContent=U,D=R(),p=N("section"),y.c(),j=R(),v=N("div"),J(u.$$.fragment),this.h()},l(g){e=I(g,"DIV",{class:!0});var T=S(e);n=I(T,"DIV",{class:!0});var M=S(n);t=I(M,"A",{class:!0,href:!0});var te=S(t);r=K(te,"arrow_back_ios"),te.forEach(b),c=H(M),a=I(M,"H3",{class:!0});var ne=S(a);o=K(ne,l),ne.forEach(b),d=H(M),_=I(M,"BUTTON",{class:!0,["data-svelte-h"]:!0}),ge(_)!=="svelte-qvcjja"&&(_.textContent=U),M.forEach(b),D=H(T),p=I(T,"SECTION",{class:!0});var se=S(p);y.l(se),se.forEach(b),j=H(T),v=I(T,"DIV",{});var re=S(v);Y(u.$$.fragment,re),re.forEach(b),T.forEach(b),this.h()},h(){P(t,"class","btn-icon material-symbols-outlined w-8 h-8"),P(t,"href",we+"/chatrooms"),P(a,"class","h3 px-2 my-auto"),P(_,"class","material-symbols-outlined ml-auto mr-3 w-8 h-8 my-auto"),P(n,"class","h-auto flex flex-row variant-filled-primary mt-4 p-1"),P(p,"class","p-1 overflow-y-auto space-y-4"),w(p,"placeholder",!s[4].length),w(p,"animate-pulse",!s[4].length),P(e,"class","flex flex-col overflow-hidden px-4 lg:pl-0")},m(g,T){W(g,e,T),m(e,n),m(n,t),m(t,r),m(n,c),m(n,a),m(a,o),m(n,d),m(n,_),s[9](n),m(e,D),m(e,p),E[k].m(p,null),s[10](p),m(e,j),m(e,v),Q(u,v,null),s[11](v),h=!0,f||(i=Ee(_,"click",s[8]),f=!0)},p(g,[T]){(!h||T&32)&&l!==(l=(g[5].convo?g[5].convo:"Loading...")+"")&&q(o,l);let M=k;k=V(g),k===M?E[k].p(g,T):(F(),A(E[M],1,1,()=>{E[M]=null}),G(),y=E[k],y?y.p(g,T):(y=E[k]=C[k](g),y.c()),$(y,1),y.m(p,null)),(!h||T&16)&&w(p,"placeholder",!g[4].length),(!h||T&16)&&w(p,"animate-pulse",!g[4].length)},i(g){h||($(y),$(u.$$.fragment,g),h=!0)},o(g){A(y),A(u.$$.fragment,g),h=!1},d(g){g&&b(e),s[9](null),E[k].d(),s[10](null),X(u),s[11](null),f=!1,i()}}}function de(s){const e=s.offsetHeight,n=getComputedStyle(s),t=parseInt(n.getPropertyValue("margin-top")),r=parseInt(n.getPropertyValue("margin-bottom"));return e+t+r}function xe(s,e,n){let t;Te(s,oe,i=>n(5,t=i)),L("plugin:AndroidNotifications|createNotificationChannel",{channel_id:"base",channel_name:"Notifications"}),L("plugin:AndroidNotifications|createNotificationChannel",{channel_id:"messages",channel_name:"Chat Messages",channel_desc:"Messages sent in chats you are in."});function r(i,C){L("plugin:AndroidNotifications|simpleNotification",{id:1,title:i,content:C,channel_id:"base"}).then(E=>{console.log(E)})}var c=[];function a(i,C,E,V){c.push({text:i,time:C,sender:E,avatarBase64:V}),console.log(c),L("plugin:AndroidNotifications|chatNotification",{id:2,messages:c,channel_id:"messages"}).then(g=>{console.log(g)})}r("Android Notifications Initialized!","Good Luck");let l;var o,d,_,U;function D(){l?l.scrollTo({top:l.scrollHeight,behavior:"smooth"}):console.log(l)}var p=[];async function k(i){await Re(t.cid,i)}function y(){return window.innerHeight-de(_)-de(U)-1}function j(){n(0,l.style.maxHeight=y().toString()+"px",l),n(0,l.style.height=y().toString()+"px",l)}$e(async()=>{j(),t.token||Ue("Open a chatroom first!",()=>{Ae(we+"/chatrooms")});const i=await ie(t.cid);n(1,o=i.users),Ne(oe,t.convo=i.name,t),d=i.owner,n(4,p=await je(t.cid)),setTimeout(D,150),De(t.cid,async C=>{Object.keys(o).includes(C.author)||n(1,o=(await ie(t.cid)).users),n(4,p=[...p,C]),a(C.text,C.unixTime(),C.author,o[C.author].photo.split(",")[1]),setTimeout(D,75)},p.length),Me(async(C,E)=>{console.log(E),console.log(C)}),window.addEventListener("resize",()=>{try{j()}catch{}})});async function v(){var i;window.innerWidth<=639?i={id:"drawerChat",width:"w-screen",height:"h-[220px]",padding:"p-4",rounded:"rounded-xl",position:"top",meta:{owner:t.name===d,cid:t.cid}}:window.innerWidth<=1024?i={id:"drawerChat",width:"w-[340px]",height:"h-full",padding:"p-4",rounded:"rounded-xl",position:"right",meta:{owner:t.name===d,cid:t.cid}}:i={id:"drawerChat",width:"w-[280px] md:w-[480px]",padding:"p-4",rounded:"rounded-xl",position:"right",meta:{owner:t.name===d,cid:t.cid}},Se.open(i)}function u(i){ee[i?"unshift":"push"](()=>{_=i,n(2,_)})}function h(i){ee[i?"unshift":"push"](()=>{l=i,n(0,l)})}function f(i){ee[i?"unshift":"push"](()=>{U=i,n(3,U)})}return[l,o,_,U,p,t,k,j,v,u,h,f]}class ct extends _e{constructor(e){super(),pe(this,e,xe,Ze,me,{})}}export{ct as component};
