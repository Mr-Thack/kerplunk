import{u as s}from"./stores.0e991afd.js";import{g as l,e as h,p as f,a as i}from"./endpoint.115e5917.js";import{s as c}from"./alerts.73a0c392.js";class d{constructor(e){this.text=e.text,this.author=e.author,this.replyTo=e.reply_to,this.time=e.time,this.replies=e.replies,this.likes=e.likes,this.mid=e.mid}humanTime(){let e=new Date(this.time),t=e.getHours(),n=e.getMinutes();return(t>12?t-12:t==0?12:t)+":"+(n<10?"0"+n:n)+" "+(t>12?"P.M.":"A.M.")}elapsedTime(){let e=new Date(this.time);const n=parseInt((new Date-e)/1e3),a=parseInt(n/60),u=parseInt(a/60),m=parseInt(u/24),p=[[parseInt(m/7),"w"],[m,"d"],[u,"h"],[a,"m"],[n,"s"]];for(const r of p)if(r[0]>=1)return r[0]+r[1];return e.getUTCMonth()+1+"/"+e.getUTCDate()+"/"+e.getUTCFullYear()-2e3}unixTime(){return Math.floor(new Date(this.time).getTime()/1e3)}}async function $(o,e,t){await f(`convos/${o}`,{text:e,reply_to:t},s.readonce("token"))}async function y(o){const e=(await l(`convos/${o}/info`,{},s.readonce("token"))).data,t={};return e.users.forEach(n=>{t[n.name]=n}),{users:t,name:e.name,public:e.public,chatroom:e.chatroom,owner:e.owner}}async function D(o){return(await l(`convos/${o}`,{start:0},s.readonce("token"))).data.map(e=>new d(e))}function I(o,e,t=0){const n=new EventSource(`https://${h("stream_convos")}/${o}?token=${s.readonce("token")}&start=${t}`);n.onmessage=function(a){Promise.resolve(e(new d(JSON.parse(a.data))))}}async function M(o,e=""){const t=await i("chats",{},{name:o,pwd:e},s.readonce("token"));return t.error?(c(`JOIN ERROR: ${t.data.detail}`),console.log(t)):s.write("cid",t.data.cid),!t.error}async function O(o){const e=await i("classes",{},{code:o},s.readonce("token"));return e.error?(c(`JOIN ERROR: ${e.data}`),console.log(e)):s.write("cid",e.data.cid),!e.error}async function R(o,e,t){const a=await f("convos",{name:o,pwd:e,public:e==="",chatroom:t},s.readonce("token"));return a.error&&(c(`ERROR OPENING CONVO: ${a.data.detail}`),console.log(a)),!a.error}async function C(o,e){return(await i(`convos/${o}/${e}`,{},{},s.readonce("token"))).data}export{D as a,$ as b,O as c,y as g,M as j,C as l,R as m,I as s};
